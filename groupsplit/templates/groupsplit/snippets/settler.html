<script>
    /**
     * Settles a list of balances.
     *
     * Works on integer numbers (i.e. cents). Do not use floats.
     *
     * Sources:
     *
     * - https://en.wikipedia.org/wiki/Bin_packing_problem
     * - https://stackoverflow.com/q/1163116/2373688
     * - https://stackoverflow.com/q/877728/2373688
     */
    class Settler {
        /**
         *
         * @param {Array<{id: number, balance: number}>} balances
         */
        constructor(balances) {
            this.balances = balances;
            this.creditors = balances.filter((a) => a.balance > 0);
            this.debtors = balances.filter((a) => a.balance < 0);
        }

        /**
         * Returns the moves to settle the balances, using the current ordering
         * of this.creditors and this.debtors.
         *
         * E.g. for debts [-1, -2, -4] and credits [3, 4] the moves would be -1
         * and -2 to the 3 creditor, and -4 to 4.
         *
         * The order of this.creditors and this.debtors determines how optimal
         * the number of moves is.
         *
         * @return {Array<{from: number, to: number, amount: number}>}
         */
        getMoves() {
            if (this.debtors.length === 0) {
                // Note: in this case, creditors must also have length 0,
                // unless the balances are wrong.
                return [];
            }
            // Current index and remaining balance for this.creditors
            let c = 0;
            let cRem = this.creditors[c].balance;

            let moves = [];
            for (let d = 0; d < this.debtors.length; d++) {
                // Remaining balance for the current debtor (is negative)
                let dRem = this.debtors[d].balance;

                while (dRem < 0) {
                    // If the creditor remaining amount is exhausted, move to
                    // the next creditor.
                    //
                    // There must always be a next creditor, unless the
                    // balances are wrong.
                    if (cRem === 0) {
                        cRem = this.creditors[++c].balance;
                    }
                    let amount = Math.min(-dRem, cRem);
                    moves.push({
                        "from": this.debtors[d].id,
                        "to": this.creditors[c].id,
                        "amount": amount,
                    });
                    dRem += amount;
                    cRem -= amount;
                }
            }
            return moves;
        }

        /**
         * Helper function to format as euros.
         *
         * @param {number} cents The cent value as an integer number.
         * @return {string} A formatted currency string.
         */
        static euroFormat(cents) {
            return new Intl.NumberFormat('nl-NL', {'style': 'currency', 'currency': 'EUR'}).format(cents / 100);
        }
    }
</script>
